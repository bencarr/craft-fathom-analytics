{% extends 'fathom/widgets/range-widget.twig' %}
{% set total_pageviews = collect(response).sum('pageviews') %}
{% set total_visits = collect(response).sum('visits') %}

{% block widget %}
    <div class="fathom--browsers">
        <div class="fathom-chart">
            <canvas id="{{ chartId }}"></canvas>
        </div>
        <table>
            <thead>
            <tr>
                <th>Device Type</th>
                <th class="fathom-table-shrink">Views</th>
                <th class="fathom-table-shrink">Visitors</th>
            </tr>
            </thead>
            <tbody>
            {% for row in response %}
                {% set percentage = (row.pageviews + row.visits) / (total_pageviews + total_visits) * 100 %}
                <tr>
                    <td class="fathom-table-bar" style="--fathom-bar-percentage: {{ percentage }}; --fathom-bar-color: {{ colors[row.device_type] | replace('<alpha>', '1') }}; --fathom-bar-opacity: 0.25;">{{ row.device_type }}</td>
                    <td class="fathom-table-number">{{ row.pageviews | number }}</td>
                    <td class="fathom-table-number">{{ row.visits | number }}</td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>
{% endblock %}

{% js %}
new Chart(document.getElementById(chartId), {
    type: 'pie',
    options: chartSettings,
    data: chartData
});
{% endjs %}
